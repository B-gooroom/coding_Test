SELECT
  H.HISTORY_ID,
  ROUND(
    CASE
      WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 < 7 THEN C.DAILY_FEE * (DATEDIFF(H.END_DATE, H.START_DATE) + 1)
      WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 < 30 THEN C.DAILY_FEE * (DATEDIFF(H.END_DATE, H.START_DATE) + 1) * 0.95
      WHEN DATEDIFF(H.END_DATE, H.START_DATE) + 1 < 90 THEN C.DAILY_FEE * (DATEDIFF(H.END_DATE, H.START_DATE) + 1) * 0.92
      ELSE C.DAILY_FEE * (DATEDIFF(H.END_DATE, H.START_DATE) + 1) * 0.85
    END, 0) AS FEE
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY H
  INNER JOIN (SELECT *
              FROM CAR_RENTAL_COMPANY_CAR
              WHERE CAR_TYPE = '트럭'
             ) C
    ON H.CAR_ID = C.CAR_ID
ORDER BY FEE DESC, H.HISTORY_ID DESC
